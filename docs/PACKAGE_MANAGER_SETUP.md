# Package Manager API Keys & Credentials Setup

Complete guide for setting up automated publishing to various package managers and distribution channels.

## ðŸ”‘ Required Secrets

### GitHub Repository Secrets

Add these secrets to your GitHub repository settings (`Settings` â†’ `Secrets and variables` â†’ `Actions`):

#### Core Secrets
```bash
# Personal Access Token for cross-repo publishing
RELEASE_PAT=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### Package Manager Tokens
```bash
# Homebrew (macOS package manager)
HOMEBREW_GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Snapcraft (Ubuntu Snap packages)
SNAPCRAFT_STORE_CREDENTIALS=base64_encoded_credentials_here

# Docker Registry (GitHub Container Registry is automatic)
DOCKER_USERNAME=your_username
DOCKER_PASSWORD=your_password_or_token

# NPM (if distributing CLI tools via npm)
NPM_TOKEN=npm_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# APT Repository (for .deb packages)
APT_GPG_PRIVATE_KEY=-----BEGIN PGP PRIVATE KEY BLOCK-----
APT_GPG_PASSPHRASE=your_gpg_passphrase

# RPM Repository (for .rpm packages) 
RPM_GPG_PRIVATE_KEY=-----BEGIN PGP PRIVATE KEY BLOCK-----
RPM_GPG_PASSPHRASE=your_gpg_passphrase
```

## ðŸ“¦ Package Manager Setup Instructions

### 1. GitHub Container Registry (Automatic)
âœ… **Already configured** - Uses `GITHUB_TOKEN` automatically

### 2. Homebrew Tap Setup

#### Step 1: Create Homebrew Tap Repository
```bash
# Create public repository: homebrew-glinrdock
# Repository URL: https://github.com/gdsks/homebrew-glinrdock
```

#### Step 2: Generate Personal Access Token
```bash
# Go to: GitHub Settings â†’ Developer settings â†’ Personal access tokens â†’ Tokens (classic)
# Scopes needed: repo, write:packages
# Save as HOMEBREW_GITHUB_TOKEN
```

#### Step 3: Formula Template
```ruby
# Formula will be auto-generated by GitHub Actions
# File: Formula/glinrdock.rb
class Glinrdock < Formula
  desc "Container management system with web UI"
  homepage "https://github.com/gdsks/glinrdock"
  version "0.1.0-beta"
  
  if OS.mac? && Hardware::CPU.intel?
    url "https://github.com/gdsks/glinrdock/releases/download/v0.1.0-beta/glinrdock-0.1.0-beta-darwin-amd64.tar.gz"
    sha256 "checksum_here"
  elsif OS.mac? && Hardware::CPU.arm?
    url "https://github.com/gdsks/glinrdock/releases/download/v0.1.0-beta/glinrdock-0.1.0-beta-darwin-arm64.tar.gz"
    sha256 "checksum_here"
  end

  def install
    bin.install "bin/glinrdockd" => "glinrdock"
  end
end
```

### 3. Snapcraft Store Setup

#### Step 1: Create Snapcraft Account
```bash
# Go to: https://snapcraft.io/
# Create account and register app name: glinrdock
```

#### Step 2: Export Credentials
```bash
# Install snapcraft locally
sudo snap install snapcraft --classic

# Login and export credentials
snapcraft login
snapcraft export-login credentials.txt

# Base64 encode for GitHub secret
base64 -w 0 credentials.txt
# Save output as SNAPCRAFT_STORE_CREDENTIALS
```

#### Step 3: Snap Configuration
```yaml
# snap/snapcraft.yaml (already exists in project)
name: glinrdock
version: '0.1.0-beta'
summary: Container management system
description: |
  GLINRDOCK provides a web-based interface for managing Docker containers
  with advanced routing, SSL/TLS automation, and CI/CD integration.

grade: stable
confinement: strict

apps:
  glinrdock:
    command: bin/glinrdockd
    daemon: simple
    restart-condition: always
    plugs:
      - network
      - network-bind
      - docker

parts:
  glinrdock:
    plugin: dump
    source: .
    organize:
      'bin/glinrdockd': bin/glinrdockd
```

### 4. Flathub Setup (Advanced)

#### Step 1: Fork Flathub Repository
```bash
# Fork: https://github.com/flathub/flathub
# Create manifest: dev.glinrdock.Glinrdock.yml
```

#### Step 2: Flatpak Manifest
```yaml
app-id: dev.glinrdock.Glinrdock
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: glinrdockd

finish-args:
  - --share=network
  - --socket=system-bus
  - --filesystem=host

modules:
  - name: glinrdock
    buildsystem: simple
    build-commands:
      - install -D bin/glinrdockd /app/bin/glinrdockd
    sources:
      - type: archive
        url: https://github.com/gdsks/glinrdock/releases/download/v0.1.0-beta/glinrdock-0.1.0-beta-linux-amd64.tar.gz
        sha256: checksum_here
```

### 5. APT Repository (Ubuntu/Debian)

#### Step 1: Generate GPG Key
```bash
# Generate signing key
gpg --full-generate-key
# Export for GitHub secret
gpg --armor --export-secret-keys your_email@domain.com
# Save as APT_GPG_PRIVATE_KEY
```

#### Step 2: Repository Structure
```bash
# Create repository: glinrdock-apt
# Structure:
# dists/
#   stable/
#     main/
#       binary-amd64/
#         Packages
#         Packages.gz
#         Release
# pool/
#   main/
#     g/glinrdock/
#       glinrdock_0.1.0-beta_amd64.deb
```

### 6. RPM Repository (RedHat/CentOS/Fedora)

#### Step 1: Setup Copr (Fedora)
```bash
# Go to: https://copr.fedorainfracloud.org/
# Create account and new project: glinrdock
# Get API token from settings
```

#### Step 2: RPM Spec Template
```spec
Name:           glinrdock
Version:        0.1.0
Release:        1%{?dist}
Summary:        Container management system

License:        Proprietary
URL:            https://github.com/gdsks/glinrdock
Source0:        glinrdock-%{version}-linux-amd64.tar.gz

%description
GLINRDOCK provides a web-based interface for managing Docker containers
with advanced routing, SSL/TLS automation, and CI/CD integration.

%prep
%setup -q -n glinrdock-%{version}-linux-amd64

%install
mkdir -p %{buildroot}%{_bindir}
install -m 755 bin/glinrdockd %{buildroot}%{_bindir}/glinrdock

%files
%{_bindir}/glinrdock

%changelog
* Wed Sep 06 2025 GLINRDOCK Team <dev@glinrdock.dev> - 0.1.0-1
- Initial package
```

### 7. Docker Hub (Alternative Registry)

#### Step 1: Create Docker Hub Account
```bash
# Go to: https://hub.docker.com/
# Create account and repository: gdsks/glinrdock
```

#### Step 2: Generate Access Token
```bash
# Docker Hub Settings â†’ Security â†’ Access Tokens
# Save token as DOCKER_PASSWORD
# Username as DOCKER_USERNAME
```

## ðŸ¤– GitHub Actions Integration

### Updated Workflow with Package Managers

```yaml
# Add this job to .github/workflows/release.yml
package-managers:
  runs-on: ubuntu-latest
  needs: publish
  if: github.event_name == 'push' && startsWith(github.ref, 'refs/tags/')
  
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Download release artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts/

    - name: Extract version
      id: version
      run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

    # Homebrew Publishing
    - name: Update Homebrew Formula
      if: ${{ secrets.HOMEBREW_GITHUB_TOKEN }}
      run: |
        # Script to update homebrew formula
        ./scripts/update-homebrew.sh ${{ steps.version.outputs.VERSION }}
      env:
        GITHUB_TOKEN: ${{ secrets.HOMEBREW_GITHUB_TOKEN }}

    # Snap Publishing
    - name: Publish to Snap Store
      if: ${{ secrets.SNAPCRAFT_STORE_CREDENTIALS }}
      run: |
        echo "${{ secrets.SNAPCRAFT_STORE_CREDENTIALS }}" | base64 -d > credentials.txt
        snapcraft login --with credentials.txt
        snapcraft upload --release=stable glinrdock_*_amd64.snap
      env:
        SNAPCRAFT_STORE_CREDENTIALS: ${{ secrets.SNAPCRAFT_STORE_CREDENTIALS }}

    # Docker Hub Publishing (alternative)
    - name: Publish to Docker Hub
      if: ${{ secrets.DOCKER_PASSWORD }}
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
```

## ðŸ”§ Helper Scripts

### Homebrew Update Script
```bash
#!/bin/bash
# scripts/update-homebrew.sh
VERSION=$1
REPO="gdsks/homebrew-glinrdock"

# Clone homebrew tap
git clone https://github.com/$REPO.git homebrew-tap
cd homebrew-tap

# Update formula
cat > Formula/glinrdock.rb << EOF
class Glinrdock < Formula
  desc "Container management system with web UI"
  homepage "https://github.com/gdsks/glinrdock"
  version "$VERSION"
  
  if OS.mac? && Hardware::CPU.intel?
    url "https://github.com/gdsks/glinrdock/releases/download/v$VERSION/glinrdock-$VERSION-darwin-amd64.tar.gz"
    sha256 "$(curl -sL https://github.com/gdsks/glinrdock/releases/download/v$VERSION/glinrdock-$VERSION-darwin-amd64.tar.gz.sha256 | cut -d' ' -f1)"
  elsif OS.mac? && Hardware::CPU.arm?
    url "https://github.com/gdsks/glinrdock/releases/download/v$VERSION/glinrdock-$VERSION-darwin-arm64.tar.gz"
    sha256 "$(curl -sL https://github.com/gdsks/glinrdock/releases/download/v$VERSION/glinrdock-$VERSION-darwin-arm64.tar.gz.sha256 | cut -d' ' -f1)"
  end

  def install
    bin.install "bin/glinrdockd" => "glinrdock"
  end
end
EOF

# Commit and push
git add .
git commit -m "Update glinrdock to $VERSION"
git push
```

## âœ… Testing Package Installations

### Test Commands for Each Package Manager

```bash
# Homebrew
brew tap gdsks/glinrdock
brew install glinrdock
glinrdock --version

# Snap
sudo snap install glinrdock
glinrdock --version

# APT (after setting up repository)
curl -fsSL https://apt.glinrdock.dev/gpg | sudo gpg --dearmor -o /usr/share/keyrings/glinrdock.gpg
echo "deb [signed-by=/usr/share/keyrings/glinrdock.gpg] https://apt.glinrdock.dev stable main" | sudo tee /etc/apt/sources.list.d/glinrdock.list
sudo apt update
sudo apt install glinrdock

# Docker
docker pull ghcr.io/gdsks/glinrdock:latest
docker run --rm ghcr.io/gdsks/glinrdock:latest --version
```

## ðŸ”’ Security Best Practices

### Secret Management
- Use environment-specific secrets
- Rotate tokens regularly
- Monitor secret usage in audit logs
- Use least-privilege access for tokens

### Code Signing
- Sign all binaries and packages
- Use different keys for different platforms
- Store signing keys in secure vaults
- Implement key rotation procedures

### Distribution Security
- Verify checksums for all packages
- Use HTTPS for all downloads
- Implement vulnerability scanning
- Monitor for supply chain attacks

## ðŸ“Š Analytics & Monitoring

### Download Tracking
```bash
# GitHub Releases API
curl -H "Authorization: token $GITHUB_TOKEN" \
  https://api.github.com/repos/gdsks/glinrdock/releases/latest

# Package manager APIs
brew analytics --install-on-request gdsks/glinrdock/glinrdock
```

### Automated Alerts
- Setup notifications for failed releases
- Monitor download metrics
- Track adoption across platforms
- Alert on security vulnerabilities

This setup provides comprehensive coverage across all major package distribution channels while maintaining security and automation.